<div class="min-h-screen bg-black text-white p-6">
  <div class="max-w-2xl mx-auto py-12">
    <div class="flex justify-center mb-8">
      <img src="assets/logo.png" alt="Notify Logo" class="h-16 w-auto object-contain max-w-[200px]">
    </div>

    <div class="bg-gray-900 rounded-2xl shadow-2xl p-8 border border-gray-800">
      <h2 class="text-3xl font-bold text-center mb-8 text-white">Crear Cuenta</h2>

      @if (successMessage()) {
      <div class="mb-6 p-4 bg-[#1DB954]/20 border border-[#1DB954] rounded-lg text-[#1DB954]">
        {{ successMessage() }}
      </div>
      }

      @if (errorMessage()) {
      <div class="mb-6 p-4 bg-red-500/20 border border-red-500 rounded-lg text-red-200 whitespace-pre-line">
        {{ errorMessage() }}
      </div>
      }

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <div>
          <label for="username" class="block text-sm font-medium mb-2">Username *</label>
          <input type="text" id="username" formControlName="username"
            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
            placeholder="Choose a username" />
          @if (isFieldInvalid('username')) {
          <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('username') }}</p>
          }
        </div>

        <div>
          <label for="password" class="block text-sm font-medium mb-2">Password *</label>
          <input type="password" id="password" formControlName="password"
            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
            placeholder="At least 8 characters" />
          @if (isFieldInvalid('password')) {
          <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('password') }}</p>
          }
        </div>

        <div>
          <label for="confirmPassword" class="block text-sm font-medium mb-2">Confirm Password *</label>
          <input type="password" id="confirmPassword" formControlName="confirmPassword"
            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
            placeholder="Re-enter your password" />
          @if (isFieldInvalid('confirmPassword')) {
          <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('confirmPassword') }}</p>
          }
        </div>

        <div>
          <label for="email" class="block text-sm font-medium mb-2">Email</label>
          <input type="email" id="email" formControlName="email"
            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
            placeholder="your.email@example.com" />
          @if (isFieldInvalid('email')) {
          <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('email') }}</p>
          }
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="first_name" class="block text-sm font-medium mb-2">First Name</label>
            <input type="text" id="first_name" formControlName="first_name"
              class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
              placeholder="John" />
            @if (isFieldInvalid('first_name')) {
            <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('first_name') }}</p>
            }
          </div>
          <div>
            <label for="last_name" class="block text-sm font-medium mb-2">Last Name</label>
            <input type="text" id="last_name" formControlName="last_name"
              class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400"
              placeholder="Doe" />
            @if (isFieldInvalid('last_name')) {
            <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('last_name') }}</p>
            }
          </div>
        </div>

        <div>
          <label for="bio" class="block text-sm font-medium mb-2">Bio</label>
          <textarea id="bio" formControlName="bio" rows="4"
            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1DB954] focus:border-[#1DB954] text-white placeholder-gray-400 resize-none"
            placeholder="Tell us about yourself..."></textarea>
          @if (isFieldInvalid('bio')) {
          <p class="mt-1 text-sm text-red-300">{{ getErrorMessage('bio') }}</p>
          }
        </div>

        <div>
          <label for="foto" class="block text-sm font-medium mb-2">Profile Photo</label>
          <div class="flex items-center gap-4">
            <label for="foto"
              class="cursor-pointer px-4 py-2 bg-[#1DB954] hover:bg-[#1ed760] rounded-lg transition-colors text-black font-medium">
              Choose File
            </label>
            <input type="file" id="foto" accept="image/*" (change)="onFileSelected($event)" class="hidden" />
            @if (selectedFile) {
            <span class="text-white/70 text-sm">{{ selectedFile.name }}</span>
            <button type="button" (click)="removePhoto()" class="text-red-400 hover:text-red-300 text-sm">
              Remove
            </button>
            }
          </div>
          @if (previewUrl) {
          <div class="mt-4">
            <img [src]="previewUrl" alt="Preview" class="w-32 h-32 object-cover rounded-lg border border-white/20" />
          </div>
          }
        </div>

        <div class="space-y-3">
          <h3 class="text-lg font-semibold">Notification Preferences</h3>
          <div class="space-y-2">
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" formControlName="notifPorEmail"
                class="mr-2 w-4 h-4 text-[#1DB954] bg-gray-800 border-gray-700 rounded focus:ring-[#1DB954]" />
              <span>Email Notifications</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" formControlName="notifRecomendaciones"
                class="mr-2 w-4 h-4 text-[#1DB954] bg-gray-800 border-gray-700 rounded focus:ring-[#1DB954]" />
              <span>Recommendations</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" formControlName="notifGenerales"
                class="mr-2 w-4 h-4 text-[#1DB954] bg-gray-800 border-gray-700 rounded focus:ring-[#1DB954]" />
              <span>General Notifications</span>
            </label>
          </div>
        </div>

        @if (isAdmin) {
        <div class="space-y-3 border-t border-white/20 pt-6">
          <h3 class="text-lg font-semibold text-yellow-400">Administrator Permissions</h3>
          <p class="text-sm text-white/70 mb-4">Only administrators can assign these permissions to new users.</p>
          <div class="space-y-3">
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" formControlName="is_staff"
                class="mr-2 w-4 h-4 text-yellow-500 bg-white/10 border-white/20 rounded focus:ring-yellow-400" />
              <div class="flex-1">
                <span class="font-medium">Staff Status</span>
                <p class="text-xs text-white/60">Designates whether the user can log into the admin site.</p>
              </div>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" formControlName="is_superuser"
                class="mr-2 w-4 h-4 text-yellow-500 bg-white/10 border-white/20 rounded focus:ring-yellow-400" />
              <div class="flex-1">
                <span class="font-medium">Superuser Status</span>
                <p class="text-xs text-white/60">Designates that this user has all permissions without explicitly
                  assigning them.</p>
              </div>
            </label>
          </div>
        </div>
        }

        <button type="submit" [disabled]="isLoading() || registerForm.invalid"
          class="w-full py-3 bg-[#1DB954] hover:bg-[#1ed760] disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg font-semibold text-black transition-colors">
          @if (isLoading()) {
          <span>Creating Account...</span>
          } @else {
          <span>Create Account</span>
          }
        </button>

        <div class="text-center">
          <p class="text-white/70">
            Already have an account?
            <a routerLink="/login" class="text-[#1DB954] hover:text-[#1ed760] font-medium ml-1">
              Sign In
            </a>
          </p>
        </div>
      </form>
    </div>
  </div>
</div>